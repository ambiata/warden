# Schema inference

Schema inference in warden is currently extremely simple, and will be
made more sophisticated if/when that proves necessary. It operates on
the view markers generated by `warden check` and the metadata they
contain.

## Data

The metadata is generated by `warden check` as follows:

 - Process a view and decode it into a `Vector Text` of raw fields.
 - Run a `choice` parser which attempts to interpret the field as
   various different types, from most to least specific (e.g., Integer
   before Real).
 - Keep a tally of summed observations from each row.

## Compatibility

Schema field types form a partially-ordered set under set inclusion
which looks kinda like a join semilattice. For example, if a given
field is classified as a  `CategoricalField`, it's not an anomaly
(from the fairly limited perspective of schema inference) if some of
its values are classifed as `LooksBoolean` (e.g., from the set
{"true", "false", "undetermined"}).

Thus, a `FieldLooks` value `v` is said to be compatible with a
`FieldType` `t` if one would expect to see values which look like `v`
in an error-free field of type `t`. For example, the field type
`RealField` is compatible with `LooksIntegral` observations as the
integers are contained within the reals (sorry Liam), but not the
inverse.

```
    Real+---------Text-------+ Boolean
        |
        |
        v
    Integral
```

## Schema generation

Roughly:

 - Check the markers for incompatibilities (e.g., same number of
   fields), then aggregate them.
 - Starting with an empty set of type-indexed counts C, for each field
   `f` and for every possible field type `t`, for each 
   observation count associated with `f` which is compatible with `t`,
   increment `C_t`.
 - Select as candidates all types with counts higher than a threshold
   (say 95%). (There must be at least one of these, as Text is
   all-inclusive).
 - Take the minimum (most specific) type by set inclusion from the
   candidates. If there are multiple minima, fail.
